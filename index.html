<!-- index.html -->
<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Abdu Videos</title>
<style>
  body{background:#050505;color:#eee;font-family:Arial, "Cairo", sans-serif;padding:30px;display:flex;justify-content:center}
  .box{max-width:800px;width:100%;background:#0f0f12;padding:22px;border-radius:12px}
  h1{color:#ff4d4f}
  input{width:100%;padding:12px;border-radius:8px;border:none;background:#111;color:#fff;margin:12px 0}
  button{background:#ff4d4f;color:#fff;padding:12px 16px;border-radius:8px;border:none;font-weight:700;cursor:pointer}
  #progress{margin-top:14px;color:#9bd}
</style>
</head>
<body>
  <div class="box">
    <h1>🎬 Abdu Videos</h1>
    <p>ألصق رابط يوتيوب وسيبدأ التحميل تلقائي</p>
    <form id="f" action="/start" method="post" onsubmit="start(event)">
      <input id="url" name="url" type="text" placeholder="رابط الفيديو">
      <button type="submit">ابدأ التحميل</button>
    </form>
    <div id="progress"></div>
  </div>

<script>
  async function start(e){
    e.preventDefault();
    const url = document.getElementById('url').value.trim();
    if(!url) return alert('ادخلي رابط');
    const r = await fetch('/start',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url})});
    const j = await r.json();
    if(!j.ok) return alert('خطأ: ' + j.msg);
    document.getElementById('progress').innerText = 'جاري التحميل...';
    let iv = setInterval(async ()=>{
      let s = await (await fetch('/status')).json();
      document.getElementById('progress').innerText = s.status + ' ' + s.percent + '%';
      if(s.status === 'done'){ clearInterval(iv); window.location = '/get'; }
      if(s.status === 'error'){ clearInterval(iv); alert('خطأ: ' + s.message); }
    },1200);
  }
</script>
</body>
</html>
